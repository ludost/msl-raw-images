<html>
<head>
<script src="js/jquery-1.8.0.min.js"></script>
<script src="js/jquery-ui-1.8.22.custom.min.js"></script>
<script src="js/pure_min.js"></script>
<link rel="styleSheet" href="css/chosen.css"></link>
<script src="js/chosen.jquery.min.js"></script>
<script src="js/jquery.sharrre-1.3.2.min.js"></script>
<style>
html {
	background: url(images/bg2.jpg) no-repeat center center fixed; 
	-webkit-background-size: cover;
	-moz-background-size: cover;
	-o-background-size: cover;
	background-size: cover;
}
.tab-template {	display: none; }
input.default { padding: 0px !important }
img { width: 64px }
table { 
	text-align: left;
	border:1px solid #8a2d05;
	-webkit-border-radius: 5px;
	-moz-border-radius: 5px;
	border-radius: 5px;
}
td.sol { text-align: center }
td,th {	
	vertical-align: top;
	white-space:nowrap;
}
th {
	padding: 2px;
	border:1px solid #8a2d05;
	-webkit-border-radius: 5px;
	-moz-border-radius: 5px;
	border-radius: 5px;
	-moz-box-shadow:    1px 1px 2px 1px #8a2d05;
  	-webkit-box-shadow: 1px 1px 2px 1px #8a2d05;
  	box-shadow:         1px 1px 2px 1px #8a2d05;
}
.footer {
	font-size:smaller;
}
.less {	display: none }
.solInput { width: 3em }
div.sharrre { display:block; }
div.headerDiv {
	display:block;
	height:55px;
	white-space:nowrap;
}
div.buttonDiv {
	display:block;
	height:45px;
	white-space:nowrap;
	float:left;
	border:1px solid #8a2d05;
	-webkit-border-radius: 5px;
	-moz-border-radius: 5px;
	border-radius: 5px;
	-moz-box-shadow:    1px 1px 2px 1px #8a2d05;
  	-webkit-box-shadow: 1px 1px 2px 1px #8a2d05;
  	box-shadow:         1px 1px 2px 1px #8a2d05;
}
.backgroundButton {
	font-size:11px;
}
.sharrre .box {	float: left;  }
.sharrre .count {
	color: #444444;
	display: none;
	font-size: 17px;
	line-height: 34px;
	height: 34px;
	padding: 4px 0;
	position: relative;
	text-align: center;
	text-decoration: none;
	width: 50px;
	background-color: #eee;
	-webkit-border-radius: 4px;
	-moz-border-radius: 4px;
	border-radius: 4px;
}

.sharrre .share {
	color: #FFFFFF;
	display: block;
	font-size: 11px;
	height: 16px;
	line-height: 16px;
	margin-top: 3px;
	margin-left: 20px;
	padding: 0;
	text-align: center;
	text-decoration: none;
	width: 50px;
	background-color: red;
	-webkit-border-radius: 4px;
	-moz-border-radius: 4px;
	border-radius: 4px;
}

.sharrre .buttons {
	display: none;
	position: absolute;
	margin-left: 50px;
	z-index: 10;
}

.sharrre .button {
	float: left;
	max-width: 50px;
	margin-left: 10px;
}
</style>
<script>
	max_show = 20;
	settings = {
		show_count : max_show,
		show_thumbs : false,
		filter_sol : -1,
		filter_cam : [],
		filter_thumbs : false,
		show_background: true
	}
	conf = {};
	if (typeof (localStorage["msl-raws-conf"]) != "undefined"
			&& localStorage["msl-raws-conf"] != "") {
		conf = JSON.parse(localStorage["msl-raws-conf"]);
	}
	conf = $.extend({}, settings, conf);

	highest_sol = 0;
	count = 0;
	data = {};
	camList = "";

	function filter(a) {
		if (a.item.sol > highest_sol)
			highest_sol = a.item.sol;
		if (conf.filter_sol >= 0 && a.item.sol != conf.filter_sol)
			return false;
		if (conf.filter_thumbs && a.item.type == "thumbnail")
			return false;
		if (conf.filter_cam.length > 0
				&& $.inArray(a.item.camera, conf.filter_cam) == -1)
			return false;
		if (count++ > conf.show_count)
			return false;
		return true;
	}
	function sort(a, b) {
		if (a.sol == b.sol) {
			return a.unixTimeStamp < b.unixTimeStamp ? 1 : -1;
		}
		return a.sol > b.sol ? -1 : 1;
	}
	function render() {
		localStorage["msl-raws-conf"] = JSON.stringify(conf);

		$(".less").toggle(conf.show_count > max_show);
		$('.tab-target th.name').html("Name (loading....)");
		count = 0;
		$('.tab-target').replaceWith($('.tab-template').clone().directives({
			'.thumbBox@checked' : function(a) {
				return conf.show_thumbs ? "checked" : ""
			},
			'.solBox@checked' : function(a) {
				return conf.filter_sol >= 0 ? "" : "checked"
			},
			'.typeBox@checked' : function(a) {
				return conf.filter_thumbs ? "checked" : ""
			},
			'.line-template' : {
				'image<-context' : {
					'.name' : 'image.name',
					'.name@href' : 'image.url',
					'.sol' : 'image.sol',
					'.type' : 'image.type',
					'.cam' : 'image.camera',
					'.thumbnail' : function(a) {
						if (conf.show_thumbs) {
							return '<img src="'+a.item.thumbnailUrl+'">';
						}
						return "";//TODO: link to load single image
					},
					'.date' : 'image.date'
				},
				sort : function(a, b) {
					return sort(a, b);
				},
				filter : function(a) {
					return filter(a);
				}
			}
		}).render(data).removeClass('tab-template').addClass('tab-target'));

		//Revert input fields to conf values:
		if (conf.filter_sol < 0) {
			$(".solInput").val(highest_sol);
		} else {
			$(".solInput").val(conf.filter_sol);
		}
		$('.sol .newest').html(" ->" + highest_sol);
		$(".more,.all").toggle(count >= conf.show_count);
		$(".tab-target .camSelectMulti").val(conf.filter_cam);
		$(".tab-target .camSelectMulti").chosen();
		if (!conf.show_background){
			$("html").css("background-image","none");
		} else {
			$("html").css("background-image","url(images/bg2.jpg)");			
		}
		//Done
	}
	function reload() {
		$.ajax({
			url : "/landing?flat",
			statusCode : {
				200 : function(json) {
					data = json;
					render();
				}
			}
		});
	}
	function startSharrre() {
		$("#sharrre").sharrre({
			share: {
				 googlePlus: true,
				 facebook: true,
				 twitter: true
			 },
			 buttons: {
				 googlePlus: {size: 'tall'},
				 facebook: {layout: 'box_count'},
				 twitter: {count: 'vertical', via: 'Stellingwerff'}
			 },
			 click: function(api, options){
				 $(api.element).find('.buttons').toggle();
			 },
			 enableTracking: true,
			 urlCurl: "",
			 title: "Follow the raw images Curiosity sends back to Earth each sol. This site is focused on providing easy access for downloading, listing and organizing the raw images."

		});
	}
</script>

<script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push([ '_setAccount', 'UA-34102591-1' ]);
	_gaq.push([ '_trackPageview' ]);

	(function() {
		var ga = document.createElement('script');
		ga.type = 'text/javascript';
		ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl'
				: 'http://www')
				+ '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0];
		s.parentNode.insertBefore(ga, s);
	})();
</script>
</head>
<body onLoad="reload();startSharrre()">
	<div class="buttonDiv">
	<input class="backgroundButton" type="button" onClick="conf.show_background=(conf.show_background?false:true); render()" value="background?"/><br>
	<div id="sharrre"
		data-url="http://msl-raw-images.appspot.com/lists.html"
		data-text="MSL Curiosity Raw images listing" data-title="share!"></div>
	</div>
	<div class="headerDiv"><h1><center>MSL Curiosity - Raw images listing</center></h1></div>
	<table class="tab-target">
		<tr>
			<td>Loading data, please wait.....</td>
		</tr>
	</table>
	<table class="tab-template">
		<tr class=header>
			<th class="thumbnail">Thumbnails<br>
				<hr>Show:<input class="thumbBox" type="checkbox"
				onChange="conf.show_thumbs?conf.show_thumbs=false:conf.show_thumbs=true;render();"></th>
			<th class="name">Name<br>
				<hr>
				<!-- <input type=button onClick="reload()" value="Reload data"/> -->	
			</th>
			<th class="sol">Sol<span class="newest"></span><br>
				<hr> 
				<input class="solInput" type="text" value="" onChange="if ($('.solBox:checked').length==0){conf.filter_sol=this.value; render()}" />
				&nbsp;All:<input class='solBox' type="checkbox"	onChange="this.checked?conf.filter_sol=-1:conf.filter_sol=$('.solInput').val(); render()" />
			</th>
			<th>Date<br><hr></th>			
			<th class="type">Type<br>
				<hr> Full only:
				<input class="typeBox" type="checkbox" onChange="conf.filter_thumbs?conf.filter_thumbs=false:conf.filter_thumbs=true; render()" />
			</th>
			<th class="cam">Camera<br>
				<hr> 
				<select class="camSelectMulti chzn-select" data-placeholder="All" multiple="multiple"
				onChange="conf.filter_cam=$(this).val()!=null?$(this).val():[];render()">
					<optgroup label="science cameras">
						<option value="MH">(MH) MAHLI HandCam</option>
						<option value="CR0">(CR0) ChemCam</option>
						<option value="ML">(ML) MastCam Left</option>
						<option value="MR">(MR) MastCam Right</option>
					</optgroup>
					<optgroup label="engineering cameras">
						<option value="NLA">(NLA) NavCam Left</option>
						<option value="NRA">(NRA) NavCam Right</option>
						<option value="FLA">(FLA) Front Left HazCam</option>
						<option value="FRA">(FRA) Front Right HazCam</option>
						<option value="RLA">(RLA) Rear Left HazCam</option>
						<option value="RRA">(RRA) Rear Right HazCam</option>
						<option value="MD">(MD) MARDI DescentCam</option>
					</optgroup>
					<optgroup label="secondary engineering cameras">
						<option value="NLB">(NLB) NavCam Left</option>
						<option value="NRB">(NRB) NavCam Right</option>
						<option value="FLB">(FLB) Front Left HazCam</option>
						<option value="FRB">(FRB) Front Right HazCam</option>
						<option value="RLB">(RLB) Rear Left HazCam</option>
						<option value="RRB">(RRB) Rear Right HazCam</option>
					</optgroup>
			</select>
			</th>
		</tr>
		<tr class="line-template">
			<td class="thumbnail"></td>
			<td><a href="" class="name" target="_blank"></a></td>
			<td class="sol"></td>
			<td class="date"></td>	
			<td class="type"></td>
			<td class="cam"></td>
		</tr>
		<tr>
			<td colspan=3><input class="more" type="button"
				onClick="conf.show_count+=max_show;render(false)" value="show more" />
				<input class="all" type="button"
				onClick="conf.show_count=999999;render(false)" value="show all" />
				<input class="less" type="button"
				onClick="conf.show_count=max_show;render()" value="show less" /></td>
		</tr>
	</table>
	<div class="footer">
	This site is developed by Ludo Stellingwerff.<br>
	I don't own any of the data on this site, massive thanks to NASA for sharing this with all of us.
	</div> 
</body>
</html>